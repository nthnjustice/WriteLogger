<div class="card hoverable">
	<div class="card-content">
		<span class="card-title"><h5>Start Live Writing Session</h5></span>
		<div class="divider"></div>
		<br>
		<div id="clock-type-wrapper">
			<a class="waves-effect waves-light btn" id="stopwatch-button">Stopwatch</a>
			<a class="waves-effect waves-light btn" id="timer-button">Timer</a>
		</div>
		<div id="stopwatch-wrapper" class="hidden">
			<div class="section">
				<div id="stopwatch-custom-error" class="row center hidden">
					<div class="card-panel red lighten-5">
	    			<span class="red-text text-darken-4">
	      			The form contains 1 error:
	      			<ul>
	        			<li>* Title can't be blank</li>
	      			</ul>
	    			</span>
	  			</div>
	  		</div>
				<div class="row center">
					<div class="col l12">
						<div id="clock1"></div>
					</div>
				</div>
				<div class="row">
					<div class="col l12">
						<span id="stopwatch-start-wrapper">
							<a class="waves-effect waves-light btn" id="stopwatch-start">
								<i class="material-icons right">play_arrow</i>
								Start
							</a>
						</span>
						<span id="stopwatch-pause-wrapper" class="hidden">
							<a class="waves-effect waves-light btn" id="stopwatch-pause">
								<i class="material-icons right">pause</i>
								Pause
							</a>
						</span>
						<span id="stopwatch-resume-wrapper" class="hidden">
							<a class="waves-effect waves-light btn" id="stopwatch-resume">
								<i class="material-icons right">play_arrow</i>
								Resume
							</a>
						</span>
					</div>
				</div>
				<div id="stopwatch-form-wrapper" class="hidden">
					<div class="input-field">
						<input id="stopwatch-form-title" type="text">
						<label for="stopwatch-form-title">Title <span class="red-text">*</span></label>
					</div>
					<div class="row center">
						<a id="stopwatch-form-post" class="waves-effect waves-light btn green darken-2">
							Post <i class="material-icons right">send</i>
						</a>
					</div>
				</div>
			</div>
		</div>
		<div id="timer-wrapper" class="hidden">
			<div class="section">
				<div id="timer-custom-error" class="row center hidden">
					<div class="card-panel red lighten-5">
	    			<span class="red-text text-darken-4">
	      			The form contains 1 error:
	      			<ul>
	        			<li>* Title can't be blank</li>
	      			</ul>
	    			</span>
	  			</div>
	  		</div>
	  		<div id="timer-value-wrapper">
	  			<div class="row">
	  				<p>Set the timer's value:</p>
	  			</div>
	  			<div class="row">
	  				<div class="col l4">
	  					<div class="input-field">
	  						<input id="timer-value-hours" type="number" value=0>
	  						<label for="timer-value-hours">Hours <span class="red-text">*</span></label>
	  					</div>
	  				</div>
	  				<div class="col l4">
	  					<div class="input-field">
	  						<input id="timer-value-minutes" type="number" value=30>
	  						<label for="time-value-minutes">Minutes <span class="red-text">*</span></label>
	  					</div>
	  				</div>
	  				<div class="col l4">
	  					<div class="input-field">
	  						<input id="timer-value-seconds" type="number" value=0>
	  						<label for="time-value-seconds">Seconds <span class="red-text">*</span></label>
	  					</div>
	  				</div>
	  			</div>
	  			<div class="row center">
	  				<a id="timer-value-set" class="waves-effect waves-light btn">Set</a>
	  			</div>
	  		</div>
	  		<div id="timer-clock-wrapper" class="hidden">
	  			<div class="row center">
						<div class="col 12">
							<div id="clock2"></div>
						</div>
					</div>
					<div class="row">
						<div class="col l12">
							<span id="timer-start-wrapper">
								<a class="waves-effect waves-light grey lighten-1 btn" id="timer-back">
									<i class="material-icons left">arrow_back</i>
									Back
								</a>
								<a class="waves-effect waves-light btn" id="timer-start">
									<i class="material-icons right">play_arrow</i>
									Start
								</a>
							</span>
							<span id="timer-pause-wrapper" class="hidden">
								<a class="waves-effect waves-light btn" id="timer-pause">
									<i class="material-icons right">pause</i>
									Pause
								</a>
							</span>
							<span id="timer-resume-wrapper" class="hidden">
								<a class="waves-effect waves-light btn" id="timer-resume">
									<i class="material-icons right">play_arrow</i>
									Resume
								</a>
							</span>
						</div>
					</div>
					<div id="timer-form-wrapper" class="hidden">
						<div class="input-field">
							<input id="timer-form-title" type="text">
							<label for="timer-form-title">Title <span class="red-text">*</span></label>
						</div>
						<div class="row center">
							<a id="timer-form-post" class="waves-effect waves-light btn green darken-2">
								Post <i class="material-icons right">send</i>
							</a>
						</div>
					</div>
	  		</div>
	  	</div>
		</div>
	</div>
</div>

<script>
  $('label').addClass('active')

  $("#stopwatch-button").click(function() {
	  $("#clock-type-wrapper").toggleClass("hidden");
	  $("#stopwatch-wrapper").toggleClass("hidden");
	});

	finalTime1 = [];

	clock1 = new FlipClock($('#clock1'), {
	  autoStart: false,
	  callbacks: {
	    start: () => {
	      timeStarted1 = new Date();
	    },
	    stop: () => {
	      timeStopped1 = new Date();
	      finalTime1.push(timeStopped1 - timeStarted1);
	    }
	  }
	});

	$("#stopwatch-start").click(function() {
	  clock1.start(function() {});
	  $("#stopwatch-form-wrapper").toggleClass("hidden");
	  $("#stopwatch-start-wrapper").toggleClass("hidden");
	  $("#stopwatch-pause-wrapper").toggleClass("hidden");
	});

	$("#stopwatch-pause").click(function() {
	  clock1.stop(function() {});
	  $("#stopwatch-form-wrapper").toggleClass("hidden");
	  $("#stopwatch-pause-wrapper").toggleClass("hidden");
	  $("#stopwatch-resume-wrapper").toggleClass("hidden");
	});

	$("#stopwatch-resume").click(function() {
	  clock1.start(function() {});
	  $("#stopwatch-form-wrapper").toggleClass("hidden");
	  $("#stopwatch-resume-wrapper").toggleClass("hidden");
	  $("#stopwatch-pause-wrapper").toggleClass("hidden");
	});

	$("#stopwatch-form-post").click(function() {
	  clock1.stop(function() {});

	  if($("#stopwatch-form-title").val() === "") {
	    $("#stopwatch-custom-error").toggleClass("hidden");
	    $("#stopwatch-form-wrapper").toggleClass("hidden");
	    $("#stopwatch-pause-wrapper").toggleClass("hidden");
	    $("#stopwatch-resume-wrapper").toggleClass("hidden");
	  }
	  
	  totalTime1 = 0;
	  $.each(finalTime1, function(index, value) {
	    totalTime1 = totalTime1 + value;
	  });

	  minutes1 = Math.round((totalTime1/(1000*60))%60)
	  hours1 = Math.round((totalTime1/(1000*60*60))%24)

	  $.ajax({
	    url: "/microposts",
	    type: "POST",
	    data: {
	      micropost: {
	        title: $("#stopwatch-form-title").val(),
	        author: "<%= current_user.name %>",
	        hours: hours1,
	        minutes: minutes1
	      }
	    }
	  });
	});

	$("#timer-button").click(function() {
	  $("#clock-type-wrapper").toggleClass("hidden");
	  $("#timer-wrapper").toggleClass("hidden");
	});

	audioElement = document.createElement('audio');
  audioElement.setAttribute('src', 'http://www.soundjay.com/misc/sounds/bell-ringing-01.mp3');

	function flash() {
		$('body').toggleClass('laser');
    audioElement.play();
	}

	$("#timer-value-set").click(function() {
	  $("#timer-value-wrapper").toggleClass("hidden");
	  $("#timer-clock-wrapper").toggleClass("hidden");

	  timerHours = Number($("#timer-value-hours").val());
	  timerMinutes = Number($("#timer-value-minutes").val());
	  timerSeconds = Number($("#timer-value-seconds").val());

	  timerTotal1 = timerHours * 60 * 60;
	  timerTotal2 = timerMinutes * 60;
	  timerFinal = timerSeconds + timerTotal1 + timerTotal2;

	  finalTime2 = [];

	  clock2 = $("#clock2").FlipClock(timerFinal, {
	    countdown: true,
	    clockFace: 'HourCounter',
	    autoStart: false,
	    callbacks: {
		    start: () => {
		      timeStarted2 = new Date();
		      setTimeout(flash, timerFinal * 1000);
		    },
		    stop: () => {
		      timeStopped2 = new Date();
		      finalTime2.push(timeStopped2 - timeStarted2);
		    }
			}
	  });
	});

	$("#timer-back").click(function() {
		$("#timer-value-wrapper").toggleClass("hidden");
	  $("#timer-clock-wrapper").toggleClass("hidden");
	});
	
	$("#timer-start").click(function() {
	  clock2.start(function() {});
	  $("#timer-back").toggleClass("hidden");
	  $("#timer-form-wrapper").toggleClass("hidden");
	  $("#timer-start-wrapper").toggleClass("hidden");
	  $("#timer-pause-wrapper").toggleClass("hidden");
	});

	$("#timer-pause").click(function() {
	  clock2.stop(function() {});
	  $("#timer-form-wrapper").toggleClass("hidden");
	  $("#timer-pause-wrapper").toggleClass("hidden");
	  $("#timer-resume-wrapper").toggleClass("hidden");
	});

	$("#timer-resume").click(function() {
	  clock2.start(function() {});
	  $("#timer-form-wrapper").toggleClass("hidden");
	  $("#timer-resume-wrapper").toggleClass("hidden");
	  $("#timer-pause-wrapper").toggleClass("hidden");
	});

	$("#timer-form-post").click(function() {
	  clock2.stop(function() {});
	  audioElement.pause();

	  if($("#timer-form-title").val() === "") {
	    $("#timer-custom-error").toggleClass("hidden");
	    $("#timer-form-wrapper").toggleClass("hidden");
	    $("#timer-pause-wrapper").toggleClass("hidden");
	    $("#timer-resume-wrapper").toggleClass("hidden");
	  }

	  totalTime2 = 0;
	  $.each(finalTime2, function(index, value) {
	    totalTime2 = totalTime2 + value;
	  });

	  minutes2 = Math.round((totalTime2/(1000*60))%60)
	  hours2 = Math.round((totalTime2/(1000*60*60))%24)

	  console.log(minutes2);
	  console.log(hours2);

	  $.ajax({
	    url: "/microposts",
	    type: "POST",
	    data: {
	      micropost: {
	        title: $("#timer-form-title").val(),
	        author: "<%= current_user.name %>",
	        hours: hours2,
	        minutes: minutes2
	      }
	    }
	  });
	});
</script>